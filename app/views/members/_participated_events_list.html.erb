<%= form_tag :search_participated_members, method: 'get', remote: true, class: "form-inline", role: "form" do %>
  <div class="form-group">
    <span>メンバー検索</span>
    <%= text_field_tag :search, params[:search], class: "form-control", placeholder: "name" %>
  </div>
  <%= submit_tag 'Search', :name => nil, class: 'btn btn-primary' %>
<% end %>

<% if @members.present? %>

  <%= content_tag :table, class: 'table table-condensed table-bordered table-striped' do %>
    <tr>
      <th><%= sortable('last_name_alphabet',"頭") %></th>
      <th class="col-md-1">氏名</th>
      <th class="col-md-1">属性</th>
      <th class="col-md-1"><%= sortable('affiliation',"所属") %></th>
      <th class="col-md-1">役職</th>
      <th class="col-md-1">備考</th>
      <th class="col-md-1"><%= link_to "出席回数", count: true %></th>
      <th></th>
    </tr>
    <% @members.each do |member| %>
      <%= content_tag :tr do %>
        <td><%= member.last_name_alphabet[0] if member.last_name_alphabet.present? %></td>
        <td><%= link_to "#{member.last_name} #{member.first_name}", member_path(member) %></td>
        <td><%= Category.find(member.category_id).try(:name) if member.category_id.present? %></td>
        <td><%= member.affiliation %></td>
        <td><%= member.title %></td>
        <td><%= member.note %></td>
        <td><%= member.participated_events.count %></td>
        <td>
          <table class="table table-bordered table-hover">
          <tr>
            <th>イベント名</th>
            <th>開催日</th>
            <th>Role</th>
          </tr>
          <% member.participated_events.order("start_time DESC").each do |event| %>
            <tr>
              <td><%= link_to event.name, event_path(event) %></td>
              <td><%= event.start_time.strftime("%Y/%m/%d") %></td>
              <td><%= show_role(member,event) %></td>
            </tr>
          <% end %>
          </table>
        </td>
      <% end %>
    <% end %>
  <% end %>
<% end %>




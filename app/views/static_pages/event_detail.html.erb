<style>
.event-bkg::after {
  content: "";
  background-image: url('<%= serve_file_event_path(id: @event.id, header: 'bkg')%>');
  filter: blur(8px);
  opacity: 0.5;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  position: absolute;
  z-index: -1;
}
</style>

<div class="container-fluid event-bkg" style="padding: 60px;">

  <div class="row">
    <div class="offset-11">
      <%= link_to "https://facebook.com/"+@event.fb_event_id, class: 'btn btn-primary' do %>
        <i class="fab fa-facebook-f"></i>
      <% end %>
    </div>
  </div>

  <br><br><br><br>

  <div class="row">
    <div class="offset-1">
      <h1 style="font-size: 70px;"><%= @event.name %> <%= EventCategory.find(@event.event_category_id).name if @event.event_category_id.present? %></h1>
      <h5>
        <% @presentations.sort_by{|e| e[:id]}.each do |presentation| %>
          <li><%= presentation.title %></li>
        <% end %>
      </h5>
    </div>
  </div>

  <br><br><br><br>

  <div class="row">
    <div class="offset-1">
      <h1><i class="fas fa-calendar"></i></h1>
    </div>
    <div class="col">
      <strong>WHEN</strong><br>
      <%#= @event.start_time.strftime('%Y-%m-%d %H:%M') %>
      <%= l @event.start_time, format: :default%>
    </div>
  </div>

  <br><br>

  <div class="row">
    <div class="offset-1">
      <h1><i class="fas fa-map-marker-alt"></i></h1>
    </div>
    <div class="col-9">
      <strong>WHERE</strong><br>
      <%= Place.find(@event.place_id).name if @event.place_id.present? %>
    </div>
    <div class="col">
      <small>参加費: <%= show_currency(@event.fee) %></small>
      <%= link_to "参加登録", event_detail_path(event_id: @event.id, anchor: 'registration'), class: 'btn btn-success btn-lg btn-block' %>
    </div>
  </div>

  <br><br>

</div>

<div class="container-fluid" style="background:white; padding: 60px;">

  <div class="row">
    <div class="offset-1">
      <h1>The Speakers</h1>
    </div>
  </div>

  <% n = 1 %>
  <% @presentations.sort_by{|e| e[:id]}.each do |presentation| %>

    <div class="card" id="presentation<%= n %>" data-aos="fade-up">
      <div class="row">
        <div class="col-4">
          <img src="https://picsum.photos/533/300?grayscale" class="img-fluid">
        </div>

        <div class="col-8">
          <% presentation.presenters.each do |presenter| %>
            <h3 style="display: inline;"><%= "#{presenter.try(:last_name)} #{presenter.try(:first_name)} 氏" %></h3>
            <sub><strong><%= presenter.affiliation %></strong> <%= presenter.title %></sub><br>
          <% end %>

          <p><small><%= "プレゼンテーション ##{n}" %></small></p>

          <h5><ins><%= presentation.try(:title) %></ins></h5>

          <%= presentation.try(:abstract) %>
        </div>
      </div>
    </div>
    <% n += 1 %>
  <% end %>

</div>


<div class="container-fluid" style="background: rgb(250, 255, 255); padding: 60px;">
  <div class="row">
    <div class="offset-1">
      <h2>Schedule</h2>
    </div>
  </div>
</div>


<div class="container-fluid" style="background: white; padding: 60px;" id="registration">
  <div class="row">
    <div class="offset-1">
      <h2>Registration</h2>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <% if user_signed_in? %>

        <% if @relationship %>
          <h4>Thank you for the registration!</h4>
        <% else %>
          <%= link_to "参加登録", register_event_path(event_id: @event.id), method: 'post', class: 'btn btn-primary btn-lg btn-block' %>
        <% end %>

      <% else %>

        <%= form_with url: register_event_path(event_id: @event.id) do |f| %>
          <div class="form-group row">
            <%= f.label :last_name, t('user.last_name')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :last_name, placeholder: "山田", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :first_name, t('user.first_name')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :first_name, placeholder: "太郎", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :last_name_alphabet, t('user.last_name_alphabet')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :last_name_alphabet, placeholder: "Yamada", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :first_name_alphabet, t('user.last_name_alphabet')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :first_name_alphabet, placeholder: "Taro", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :category_id, t('user.category')+"(*)", class: 'col-sm-4' %>
            <%= f.select :category_id, options_from_collection_for_select(Category.all, :id, :name), { include_blank: true }, { class: "form-control col", required: 'required' } %>
          </div>

          <div class="form-group row">
            <%= f.label :affiliation, t('user.affiliation')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :affiliation, placeholder:  "海山商事", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :title, t('user.title')+"(*)", class: 'col-sm-4' %>
            <%= f.text_field :title, placeholder:  "代表取締役社長", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group row">
            <%= f.label :email, t('user.email')+"(*)", class: 'col-sm-4' %>
            <%= f.email_field :email, placeholder: "test@example.com", class: "form-control col", required: 'required' %>
          </div>

          <div class="form-group">
            <%= f.submit t('submit'), class: "btn btn-primary" %>
          </div>
        <% end %>

      <% end %>

    </div>

    <div class="col-6">
    </div>
  </div>
</div>
